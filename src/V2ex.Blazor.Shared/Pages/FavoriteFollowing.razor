@page "/favorite/following"
@attribute [Authorize]

<InfiniteList LoadAsync="LoadAsync" T="TopicViewModel">
    <ItemContent>
        <Topic ViewModel="@context"></Topic>
    </ItemContent>
</InfiniteList>

@code {
    [Inject]
    private ApiService ApiService { get; set; } = null!;

    private async Task<(int CurrentPage, int MaximumPage, IReadOnlyList<TopicViewModel>)> LoadAsync(int page)
    {
        var  followingInfo = await this.ApiService.GetFollowingInfo(page);

        if(followingInfo == null)
        {
            throw new InvalidOperationException("Can not get following info");
        }

        var topics = followingInfo.Items.Select(o => new TopicViewModel(
               "",
               "",
               o.TopicTitle,
               o.TopicLink,
               o.Avatar,
               o.UserLink,
               o.UserName,
               o.UserLink,
               o.Created,
               o.CreatedText,
               o.LastReplyUserName,
               o.NodeName,
               o.NodeLink,
               o.Replies
               )).ToList();

        return (followingInfo.CurrentPage, followingInfo.MaximumPage, topics);
    }
}
