@page "/favorite/topics"
@attribute [Authorize]


<InfiniteList LoadAsync="LoadAsync" T="TopicViewModel">
    <ItemContent>
        <Topic ViewModel="@context"></Topic>
    </ItemContent>
</InfiniteList>

@code {
    [Inject]
    private ApiService ApiService { get; set; } = null!;
    private async Task<(int CurrentPage, int MaximumPage, IReadOnlyList<TopicViewModel>)> LoadAsync(int page)
    {
        var topicInfo = await this.ApiService.GetFavoriteTopics(page);

        if (topicInfo == null)
        {
            throw new InvalidOperationException("Can not get favorite topics");
        }

        var topics = topicInfo.Items.Select(o => new TopicViewModel(
               "",
               "",
               o.TopicTitle,
               o.TopicLink,
               o.Avatar,
               o.UserLink,
               o.UserName,
               o.UserLink,
               o.Created,
               o.CreatedText,
               o.LastReplyUserName,
               o.NodeName,
               o.NodeLink,
               o.Replies
               )).ToList();

        return (topicInfo.CurrentPage, topicInfo.MaximumPage, topics);
    }
}
